/*! canvasjs 2013-12-16 */
function Canvas(a,b,c){var d=Raphael(a,b,c),e=new Array,f=new Array,g=new Array,h=new Array,i={DOWN:{value:0,name:"Down",code:"D"},UP:{value:1,name:"Up",code:"U"}},j=i.UP;$("body").keydown(function(a){17==a.which&&(j=i.DOWN)}),$("body").keyup(function(a){17==a.which&&(j=i.UP)}),this.elementClicked=function(a){if(j==i.UP)this.unselectAllElements(),g.push(a),a.setSelected();else{var b=g.indexOf(a);0>b?(g.push(a),a.setSelected()):(g.splice(b,1),a.setUnselected())}},this.dataflowClicked=function(a){if(j==i.UP)this.unselectAllDataflows(),h.push(a),a.setSelected();else{var b=g.indexOf(a);0>b?(h.push(a),a.setSelected()):(h.splice(b,1),a.setUnselected())}},this.unselectAllElements=function(){for(var a=g.pop();a;)a.setUnselected(),a=g.pop()},this.unselectAllDataflows=function(){for(var a=h.pop();a;)a.setUnselected(),a=h.pop()},this.setBackground=function(a){d.canvas.style.backgroundColor=a},this.getNumberOfElements=function(){return e.length},this.getNumberOfDataflows=function(){return f.length},this.setSize=function(a,b){d.setSize(a,b)},this.addProcess=function(a,b){var c=new l(this,a,b);return e.push(c),c},this.addMultiProcess=function(a,b){var c=new m(this,a,b);return e.push(c),c},this.addDatastore=function(a,b){var c=new n(this,a,b);return e.push(c),c},this.addExtInteractor=function(a,b){var c=new o(this,a,b);return e.push(c),c},this.addDataflow=function(a,b){if(a==b)return null;var c=new p(this,a,b);return f.push(c),c},this.addDataflowFromSelection=function(){for(var a=0;a<g.length;a++)g[a+1]&&this.addDataflow(g[a],g[a+1]);this.unselectAll()},this.removeElement=function(a){var b=e.indexOf(a);return b>-1?(e.splice(b,1),!0):!1},this.removeDataflow=function(a){var b=f.indexOf(a);return b>-1?(f.splice(b,1),!0):!1},this.calcDataflows=function(){for(var a=0;a<f.length;a++)f[a].calcPath()};var k=function(a){var b=this,c=d.set(),a=a;this.hasMoved=!0,this.push=function(){for(var a=0;a<arguments.length;a++)c.push(arguments[a]),arguments[a].mouseup(e)},this.getSet=function(){return c},this.draggable=function(){c.draggable(a.calcDataflows,b)},this.applyDefaultStyle=function(){c.attr("fill","#FFF"),c.attr("stroke","#000"),c.attr("stroke-width","1px")},this.getBBox=function(){return c.getBBox()},this.setSelected=function(){c.animate({"fill-opacity":.2},100)},this.setUnselected=function(){c.animate({"fill-opacity":1},100)};var e=function(){a.elementClicked(b)}},l=function(a,b,c){k.call(this,a),this.push(d.circle(b,c,25)),this.applyDefaultStyle(),this.draggable()};l.prototype=new k,l.prototype.constructor=l;var m=function(a,b,c){k.call(this,a),this.push(d.circle(b,c,25),d.circle(b,c,18)),this.applyDefaultStyle(),this.draggable()};m.prototype=new k,m.prototype.constructor=m;var n=function(a,b,c){k.call(this,a),b-=25,c-=25,this.push(d.path("M"+b+" "+c+" L"+(b+50)+" "+c+" Z"),d.path("M"+b+" "+(c+50)+" L"+(b+50)+" "+(c+50)+" Z")),this.applyDefaultStyle();var e=d.rect(b,c+1,50,48);e.attr("stroke-width",0),e.attr("fill","#FFF"),this.push(e),this.draggable()};n.prototype=new k,n.prototype.constructor=n;var o=function(a,b,c){k.call(this,a),this.push(d.rect(b-25,c-25,50,50)),this.applyDefaultStyle(),this.draggable()};o.prototype=new k,o.prototype.constructor=o;var p=function(a,b,c){var e,f,g=this,b=b,c=c,a=a;c.hasMoved=!0;var h=function(a){var b=a.getBBox(),c=new Array;return c.push({x:b.x,y:b.y+b.height/2}),c.push({x:b.x+b.width/2,y:b.y}),c.push({x:b.x+b.width,y:b.y+b.height/2}),c.push({x:b.x+b.width/2,y:b.y+b.height}),c};this.setSelected=function(){e.animate({"stroke-width":5},100)},this.setUnselected=function(){e.animate({"stroke-width":3},100)};var i=function(){a.dataflowClicked(g)};this.calcPath=function(){if(b.hasMoved&&c.hasMoved){for(var a,g=h(b),j=h(c),k=0,l=0,m=0;m<g.length;m++)for(var n=0;n<j.length;n++){var o=Math.abs(g[m].x-j[n].x),p=Math.abs(g[m].y-j[n].y),q=Math.sqrt(Math.pow(o,2)+Math.pow(p,2));a?a>q&&(k=m,l=n,a=q):(k=m,l=n,a=q)}var r="M"+g[k].x+" "+g[k].y+" L"+j[l].x+" "+j[l].y+" Z",s=Math.atan2(j[l].x-g[k].x,j[l].y-g[k].y);s=s/(2*Math.PI)*360;var t="M"+j[l].x+" "+j[l].y+" L"+(j[l].x-5)+" "+(j[l].y-5)+" L"+(j[l].x-5)+" "+(j[l].y+5)+" L"+j[l].x+" "+j[l].y,u="r"+-1*(-90+s)+","+j[l].x+","+j[l].y;e&&f?(e.attr({path:r}),f.attr({path:t}),f.transform(u)):(e&&e.remove(),f&&f.remove(),e=d.path(r).attr("stroke-width",3),e.mouseup(i),f=d.path(t).attr("fill","black"),f.transform(u))}},this.calcPath()}}Raphael.st.draggable=function(a,b){var c=this,b=b,d=0,e=0,f=0,g=0,h=function(h,i){d=h+f,e=i+g,c.transform("t"+d+","+e),b.hasMoved=!0,a()},i=function(){c.toFront()},j=function(){f=d,g=e};return this.drag(h,i,j),this};